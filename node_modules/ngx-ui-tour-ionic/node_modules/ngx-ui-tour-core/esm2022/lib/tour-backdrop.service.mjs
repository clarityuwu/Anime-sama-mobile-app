import { inject, Injectable, RendererFactory2 } from '@angular/core';
import { ScrollingService } from './scrolling.service';
import { TourResizeObserverService } from './tour-resize-observer.service';
import { DOCUMENT } from '@angular/common';
import { ScrollUtils } from "./scroll-utils";
import { OverflowUtils } from "./overflow-utils";
import * as i0 from "@angular/core";
export class TourBackdropService {
    constructor() {
        this.isSpotlightClosed = false;
        this.rendererFactory = inject(RendererFactory2);
        this.renderer = this.rendererFactory.createRenderer(null, null);
        this.resizeObserverService = inject(TourResizeObserverService);
        this.scrollingService = inject(ScrollingService);
        this.document = inject(DOCUMENT);
    }
    show(targetElement, step) {
        if (this.targetHtmlElement) {
            this.resizeObserverService.unobserveElement(this.targetHtmlElement);
        }
        this.targetHtmlElement = targetElement.nativeElement;
        this.step = step;
        this.resizeObserverService.observeElement(this.targetHtmlElement);
        if (!this.backdropElements) {
            this.backdropElements = this.createBackdropElements();
            this.subscribeToResizeEvents();
        }
        this.isSpotlightClosed = false;
        this.setBackdropPosition();
    }
    closeSpotlight() {
        if (!this.backdropElements) {
            return;
        }
        const targetRect = this.targetHtmlElement.getBoundingClientRect(), centerX = targetRect.left + (targetRect.width / 2), centerY = targetRect.top + (targetRect.height / 2), centerRect = {
            top: centerY,
            right: centerX,
            bottom: centerY,
            left: centerX,
            width: 0,
            height: 0
        };
        this.isSpotlightClosed = true;
        this.setBackdropPosition(centerRect);
    }
    setBackdropPosition(rectangle = null) {
        const docEl = this.document.documentElement, scrollContainer = ScrollUtils.getScrollContainer(this.step.scrollContainer) ?? docEl, elementBoundingRect = rectangle ?? this.targetHtmlElement.getBoundingClientRect(), scrollContainerRect = scrollContainer.getBoundingClientRect(), visibleSection = OverflowUtils.getVisibleSection(elementBoundingRect, scrollContainerRect), scrollHeight = docEl.scrollHeight, scrollWidth = docEl.scrollWidth, window = this.document.defaultView, scrollX = window.scrollX, scrollY = window.scrollY, offset = this.isSpotlightClosed ? 0 : this.step.backdropConfig?.offset ?? 0, leftRect = {
            width: visibleSection.left + scrollX - offset,
            height: scrollHeight,
            top: 0,
            left: 0
        }, topRect = {
            width: visibleSection.width + offset * 2,
            height: visibleSection.top + scrollY - offset,
            top: 0,
            left: visibleSection.left + scrollX - offset
        }, bottomRect = {
            width: visibleSection.width + offset * 2,
            height: scrollHeight - (visibleSection.bottom + scrollY) - offset,
            top: visibleSection.bottom + scrollY + offset,
            left: visibleSection.left + scrollX - offset
        }, rightRect = {
            width: scrollWidth - (visibleSection.right + scrollX) - offset,
            height: scrollHeight,
            top: 0,
            left: visibleSection.right + scrollX + offset
        }, rectangles = [leftRect, topRect, bottomRect, rightRect];
        for (let i = 0; i < rectangles.length; i++) {
            const styles = this.createBackdropStyles(rectangles[i]);
            this.applyStyles(styles, this.backdropElements[i]);
        }
    }
    subscribeToResizeEvents() {
        this.resizeSubscription = this.resizeObserverService.resize$
            .subscribe(() => {
            this.setBackdropPosition();
            if (!this.step.disableScrollToAnchor) {
                this.scrollingService.ensureVisible(this.targetHtmlElement, {
                    center: this.step.centerAnchorOnScroll,
                    smoothScroll: false
                });
            }
        });
    }
    close() {
        if (this.backdropElements) {
            this.resizeObserverService.unobserveElement(this.targetHtmlElement);
            this.removeBackdropElement();
            this.resizeSubscription.unsubscribe();
        }
    }
    disconnectResizeObserver() {
        this.resizeObserverService.disconnect();
    }
    removeBackdropElement() {
        this.backdropElements.forEach(backdropElement => this.renderer.removeChild(this.parentContainer, backdropElement));
        this.backdropElements = undefined;
    }
    applyStyles(styles, element) {
        for (const name of Object.keys(styles)) {
            this.renderer.setStyle(element, name, styles[name]);
        }
    }
    createBackdropStyles(rectangle) {
        const config = this.step.backdropConfig, normalizedRect = {
            ...rectangle,
            width: Math.max(rectangle.width, 0),
            height: Math.max(rectangle.height, 0)
        };
        return {
            position: 'absolute',
            width: `${normalizedRect.width}px`,
            height: `${normalizedRect.height}px`,
            top: `${normalizedRect.top}px`,
            left: `${normalizedRect.left}px`,
            backgroundColor: config?.backgroundColor ?? 'rgba(0, 0, 0, 0.7)',
            zIndex: config?.zIndex ?? '101'
        };
    }
    createBackdropElement() {
        const backdropElement = this.renderer.createElement('div');
        this.renderer.addClass(backdropElement, 'ngx-ui-tour_backdrop');
        this.renderer.appendChild(this.parentContainer, backdropElement);
        return backdropElement;
    }
    createBackdropElements() {
        return Array
            .from({ length: 4 })
            .map(() => this.createBackdropElement());
    }
    get parentContainer() {
        const parent = this.step.backdropConfig?.parentContainer;
        if (parent instanceof HTMLElement) {
            return parent;
        }
        if (typeof parent === 'string') {
            const queryResult = this.document.documentElement.querySelector(parent);
            return queryResult ?? this.document.body;
        }
        return this.document.body;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.5", ngImport: i0, type: TourBackdropService, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.1.5", ngImport: i0, type: TourBackdropService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.5", ngImport: i0, type: TourBackdropService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG91ci1iYWNrZHJvcC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LXVpLXRvdXItY29yZS9zcmMvbGliL3RvdXItYmFja2Ryb3Auc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWEsTUFBTSxFQUFFLFVBQVUsRUFBRSxnQkFBZ0IsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUUvRSxPQUFPLEVBQUMsZ0JBQWdCLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUNyRCxPQUFPLEVBQUMseUJBQXlCLEVBQUMsTUFBTSxnQ0FBZ0MsQ0FBQztBQUV6RSxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDekMsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSxrQkFBa0IsQ0FBQzs7QUF5Qi9DLE1BQU0sT0FBTyxtQkFBbUI7SUFIaEM7UUFTWSxzQkFBaUIsR0FBRyxLQUFLLENBQUM7UUFFakIsb0JBQWUsR0FBRyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUMzQyxhQUFRLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzNELDBCQUFxQixHQUFHLE1BQU0sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1FBQzFELHFCQUFnQixHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzVDLGFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7S0E2S2hEO0lBM0tVLElBQUksQ0FBQyxhQUF5QixFQUFFLElBQWlCO1FBQ3BELElBQUksSUFBSSxDQUFDLGlCQUFpQixFQUFFO1lBQ3hCLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztTQUN2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QUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxlQUFlLENBQUM7UUFFekQsSUFBSSxNQUFNLFlBQVksV0FBVyxFQUFFO1lBQy9CLE9BQU8sTUFBTSxDQUFDO1NBQ2pCO1FBQ0QsSUFBSSxPQUFPLE1BQU0sS0FBSyxRQUFRLEVBQUU7WUFDNUIsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBZ0IsQ0FBQztZQUV2RixPQUFPLFdBQVcsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztTQUM1QztRQUVELE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7SUFDOUIsQ0FBQzs4R0F2TFEsbUJBQW1CO2tIQUFuQixtQkFBbUIsY0FGaEIsTUFBTTs7MkZBRVQsbUJBQW1CO2tCQUgvQixVQUFVO21CQUFDO29CQUNSLFVBQVUsRUFBRSxNQUFNO2lCQUNyQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7RWxlbWVudFJlZiwgaW5qZWN0LCBJbmplY3RhYmxlLCBSZW5kZXJlckZhY3RvcnkyfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtTdWJzY3JpcHRpb259IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQge1Njcm9sbGluZ1NlcnZpY2V9IGZyb20gJy4vc2Nyb2xsaW5nLnNlcnZpY2UnO1xyXG5pbXBvcnQge1RvdXJSZXNpemVPYnNlcnZlclNlcnZpY2V9IGZyb20gJy4vdG91ci1yZXNpemUtb2JzZXJ2ZXIuc2VydmljZSc7XHJcbmltcG9ydCB7SVN0ZXBPcHRpb259IGZyb20gJy4vdG91ci5zZXJ2aWNlJztcclxuaW1wb3J0IHtET0NVTUVOVH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHtTY3JvbGxVdGlsc30gZnJvbSBcIi4vc2Nyb2xsLXV0aWxzXCI7XHJcbmltcG9ydCB7T3ZlcmZsb3dVdGlsc30gZnJvbSBcIi4vb3ZlcmZsb3ctdXRpbHNcIjtcclxuXHJcbmludGVyZmFjZSBSZWN0YW5nbGUge1xyXG4gICAgd2lkdGg6IG51bWJlcjtcclxuICAgIGhlaWdodDogbnVtYmVyO1xyXG4gICAgdG9wOiBudW1iZXI7XHJcbiAgICBsZWZ0OiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQmFja2Ryb3BDb25maWcge1xyXG4gICAgekluZGV4Pzogc3RyaW5nO1xyXG4gICAgYmFja2dyb3VuZENvbG9yPzogc3RyaW5nO1xyXG4gICAgLyoqXHJcbiAgICAgKiBQYXJlbnQgY29udGFpbmVyIENTUyBzZWxlY3RvciBvciBodG1sIGVsZW1lbnQgcmVmZXJlbmNlLiBTZXQgdG8gZml4IGJhY2tkcm9wIHN0YWNraW5nIGlzc3Vlcy4gRGVmYXVsdHMgdG8gYm9keS5cclxuICAgICAqL1xyXG4gICAgcGFyZW50Q29udGFpbmVyPzogc3RyaW5nIHwgSFRNTEVsZW1lbnQ7XHJcbiAgICAvKipcclxuICAgICAqIE9mZnNldCBpbiBwaXhlbHMgdG8gYWRkIHNwYWNlIGJldHdlZW4gdGhlIGJhY2tkcm9wIGFuZCB0aGUgYW5jaG9yIGVsZW1lbnQuXHJcbiAgICAgKi9cclxuICAgIG9mZnNldD86IG51bWJlcjtcclxufVxyXG5cclxuQEluamVjdGFibGUoe1xyXG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUb3VyQmFja2Ryb3BTZXJ2aWNlIHtcclxuXHJcbiAgICBwcml2YXRlIGJhY2tkcm9wRWxlbWVudHM6IEhUTUxFbGVtZW50W107XHJcbiAgICBwcml2YXRlIHRhcmdldEh0bWxFbGVtZW50OiBIVE1MRWxlbWVudDtcclxuICAgIHByaXZhdGUgc3RlcDogSVN0ZXBPcHRpb247XHJcbiAgICBwcml2YXRlIHJlc2l6ZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBpc1Nwb3RsaWdodENsb3NlZCA9IGZhbHNlO1xyXG5cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgcmVuZGVyZXJGYWN0b3J5ID0gaW5qZWN0KFJlbmRlcmVyRmFjdG9yeTIpO1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSByZW5kZXJlciA9IHRoaXMucmVuZGVyZXJGYWN0b3J5LmNyZWF0ZVJlbmRlcmVyKG51bGwsIG51bGwpO1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSByZXNpemVPYnNlcnZlclNlcnZpY2UgPSBpbmplY3QoVG91clJlc2l6ZU9ic2VydmVyU2VydmljZSk7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNjcm9sbGluZ1NlcnZpY2UgPSBpbmplY3QoU2Nyb2xsaW5nU2VydmljZSk7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGRvY3VtZW50ID0gaW5qZWN0KERPQ1VNRU5UKTtcclxuXHJcbiAgICBwdWJsaWMgc2hvdyh0YXJnZXRFbGVtZW50OiBFbGVtZW50UmVmLCBzdGVwOiBJU3RlcE9wdGlvbikge1xyXG4gICAgICAgIGlmICh0aGlzLnRhcmdldEh0bWxFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVzaXplT2JzZXJ2ZXJTZXJ2aWNlLnVub2JzZXJ2ZUVsZW1lbnQodGhpcy50YXJnZXRIdG1sRWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnRhcmdldEh0bWxFbGVtZW50ID0gdGFyZ2V0RWxlbWVudC5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIHRoaXMuc3RlcCA9IHN0ZXA7XHJcblxyXG4gICAgICAgIHRoaXMucmVzaXplT2JzZXJ2ZXJTZXJ2aWNlLm9ic2VydmVFbGVtZW50KHRoaXMudGFyZ2V0SHRtbEVsZW1lbnQpO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuYmFja2Ryb3BFbGVtZW50cykge1xyXG4gICAgICAgICAgICB0aGlzLmJhY2tkcm9wRWxlbWVudHMgPSB0aGlzLmNyZWF0ZUJhY2tkcm9wRWxlbWVudHMoKTtcclxuICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmVUb1Jlc2l6ZUV2ZW50cygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5pc1Nwb3RsaWdodENsb3NlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuc2V0QmFja2Ryb3BQb3NpdGlvbigpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbG9zZVNwb3RsaWdodCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuYmFja2Ryb3BFbGVtZW50cykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB0YXJnZXRSZWN0ID0gdGhpcy50YXJnZXRIdG1sRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcclxuICAgICAgICAgICAgY2VudGVyWCA9IHRhcmdldFJlY3QubGVmdCArICh0YXJnZXRSZWN0LndpZHRoIC8gMiksXHJcbiAgICAgICAgICAgIGNlbnRlclkgPSB0YXJnZXRSZWN0LnRvcCArICh0YXJnZXRSZWN0LmhlaWdodCAvIDIpLFxyXG4gICAgICAgICAgICBjZW50ZXJSZWN0ID0ge1xyXG4gICAgICAgICAgICAgICAgdG9wOiBjZW50ZXJZLFxyXG4gICAgICAgICAgICAgICAgcmlnaHQ6IGNlbnRlclgsXHJcbiAgICAgICAgICAgICAgICBib3R0b206IGNlbnRlclksXHJcbiAgICAgICAgICAgICAgICBsZWZ0OiBjZW50ZXJYLFxyXG4gICAgICAgICAgICAgICAgd2lkdGg6IDAsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDBcclxuICAgICAgICAgICAgfSBhcyBET01SZWN0O1xyXG5cclxuICAgICAgICB0aGlzLmlzU3BvdGxpZ2h0Q2xvc2VkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnNldEJhY2tkcm9wUG9zaXRpb24oY2VudGVyUmVjdCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRCYWNrZHJvcFBvc2l0aW9uKHJlY3RhbmdsZTogRE9NUmVjdCA9IG51bGwpIHtcclxuICAgICAgICBjb25zdCBkb2NFbCA9IHRoaXMuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LFxyXG4gICAgICAgICAgICBzY3JvbGxDb250YWluZXIgPSBTY3JvbGxVdGlscy5nZXRTY3JvbGxDb250YWluZXIodGhpcy5zdGVwLnNjcm9sbENvbnRhaW5lcikgPz8gZG9jRWwsXHJcbiAgICAgICAgICAgIGVsZW1lbnRCb3VuZGluZ1JlY3QgPSByZWN0YW5nbGUgPz8gdGhpcy50YXJnZXRIdG1sRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcclxuICAgICAgICAgICAgc2Nyb2xsQ29udGFpbmVyUmVjdCA9IHNjcm9sbENvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcclxuICAgICAgICAgICAgdmlzaWJsZVNlY3Rpb24gPSBPdmVyZmxvd1V0aWxzLmdldFZpc2libGVTZWN0aW9uKGVsZW1lbnRCb3VuZGluZ1JlY3QsIHNjcm9sbENvbnRhaW5lclJlY3QpLFxyXG4gICAgICAgICAgICBzY3JvbGxIZWlnaHQgPSBkb2NFbC5zY3JvbGxIZWlnaHQsXHJcbiAgICAgICAgICAgIHNjcm9sbFdpZHRoID0gZG9jRWwuc2Nyb2xsV2lkdGgsXHJcbiAgICAgICAgICAgIHdpbmRvdyA9IHRoaXMuZG9jdW1lbnQuZGVmYXVsdFZpZXcsXHJcbiAgICAgICAgICAgIHNjcm9sbFggPSB3aW5kb3cuc2Nyb2xsWCxcclxuICAgICAgICAgICAgc2Nyb2xsWSA9IHdpbmRvdy5zY3JvbGxZLFxyXG4gICAgICAgICAgICBvZmZzZXQgPSB0aGlzLmlzU3BvdGxpZ2h0Q2xvc2VkID8gMCA6IHRoaXMuc3RlcC5iYWNrZHJvcENvbmZpZz8ub2Zmc2V0ID8/IDAsXHJcbiAgICAgICAgICAgIGxlZnRSZWN0OiBSZWN0YW5nbGUgPSB7XHJcbiAgICAgICAgICAgICAgICB3aWR0aDogdmlzaWJsZVNlY3Rpb24ubGVmdCArIHNjcm9sbFggLSBvZmZzZXQsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHNjcm9sbEhlaWdodCxcclxuICAgICAgICAgICAgICAgIHRvcDogMCxcclxuICAgICAgICAgICAgICAgIGxlZnQ6IDBcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9wUmVjdDogUmVjdGFuZ2xlID0ge1xyXG4gICAgICAgICAgICAgICAgd2lkdGg6IHZpc2libGVTZWN0aW9uLndpZHRoICsgb2Zmc2V0ICogMixcclxuICAgICAgICAgICAgICAgIGhlaWdodDogdmlzaWJsZVNlY3Rpb24udG9wICsgc2Nyb2xsWSAtIG9mZnNldCxcclxuICAgICAgICAgICAgICAgIHRvcDogMCxcclxuICAgICAgICAgICAgICAgIGxlZnQ6IHZpc2libGVTZWN0aW9uLmxlZnQgKyBzY3JvbGxYIC0gb2Zmc2V0XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGJvdHRvbVJlY3Q6IFJlY3RhbmdsZSA9IHtcclxuICAgICAgICAgICAgICAgIHdpZHRoOiB2aXNpYmxlU2VjdGlvbi53aWR0aCArIG9mZnNldCAqIDIsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHNjcm9sbEhlaWdodCAtICh2aXNpYmxlU2VjdGlvbi5ib3R0b20gKyBzY3JvbGxZKSAtIG9mZnNldCxcclxuICAgICAgICAgICAgICAgIHRvcDogdmlzaWJsZVNlY3Rpb24uYm90dG9tICsgc2Nyb2xsWSArIG9mZnNldCxcclxuICAgICAgICAgICAgICAgIGxlZnQ6IHZpc2libGVTZWN0aW9uLmxlZnQgKyBzY3JvbGxYIC0gb2Zmc2V0XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHJpZ2h0UmVjdDogUmVjdGFuZ2xlID0ge1xyXG4gICAgICAgICAgICAgICAgd2lkdGg6IHNjcm9sbFdpZHRoIC0gKHZpc2libGVTZWN0aW9uLnJpZ2h0ICsgc2Nyb2xsWCkgLSBvZmZzZXQsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHNjcm9sbEhlaWdodCxcclxuICAgICAgICAgICAgICAgIHRvcDogMCxcclxuICAgICAgICAgICAgICAgIGxlZnQ6IHZpc2libGVTZWN0aW9uLnJpZ2h0ICsgc2Nyb2xsWCArIG9mZnNldFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZWN0YW5nbGVzOiBSZWN0YW5nbGVbXSA9IFtsZWZ0UmVjdCwgdG9wUmVjdCwgYm90dG9tUmVjdCwgcmlnaHRSZWN0XTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZWN0YW5nbGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0eWxlcyA9IHRoaXMuY3JlYXRlQmFja2Ryb3BTdHlsZXMocmVjdGFuZ2xlc1tpXSk7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwbHlTdHlsZXMoc3R5bGVzLCB0aGlzLmJhY2tkcm9wRWxlbWVudHNbaV0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN1YnNjcmliZVRvUmVzaXplRXZlbnRzKCkge1xyXG4gICAgICAgIHRoaXMucmVzaXplU3Vic2NyaXB0aW9uID0gdGhpcy5yZXNpemVPYnNlcnZlclNlcnZpY2UucmVzaXplJFxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QmFja2Ryb3BQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zdGVwLmRpc2FibGVTY3JvbGxUb0FuY2hvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbGluZ1NlcnZpY2UuZW5zdXJlVmlzaWJsZSh0aGlzLnRhcmdldEh0bWxFbGVtZW50LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZW50ZXI6IHRoaXMuc3RlcC5jZW50ZXJBbmNob3JPblNjcm9sbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtb290aFNjcm9sbDogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbG9zZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5iYWNrZHJvcEVsZW1lbnRzKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVzaXplT2JzZXJ2ZXJTZXJ2aWNlLnVub2JzZXJ2ZUVsZW1lbnQodGhpcy50YXJnZXRIdG1sRWxlbWVudCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQmFja2Ryb3BFbGVtZW50KCk7XHJcbiAgICAgICAgICAgIHRoaXMucmVzaXplU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkaXNjb25uZWN0UmVzaXplT2JzZXJ2ZXIoKSB7XHJcbiAgICAgICAgdGhpcy5yZXNpemVPYnNlcnZlclNlcnZpY2UuZGlzY29ubmVjdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVtb3ZlQmFja2Ryb3BFbGVtZW50KCkge1xyXG4gICAgICAgIHRoaXMuYmFja2Ryb3BFbGVtZW50cy5mb3JFYWNoKFxyXG4gICAgICAgICAgICBiYWNrZHJvcEVsZW1lbnQgPT4gdGhpcy5yZW5kZXJlci5yZW1vdmVDaGlsZCh0aGlzLnBhcmVudENvbnRhaW5lciwgYmFja2Ryb3BFbGVtZW50KVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGhpcy5iYWNrZHJvcEVsZW1lbnRzID0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXBwbHlTdHlsZXMoc3R5bGVzOiBQYXJ0aWFsPENTU1N0eWxlRGVjbGFyYXRpb24+LCBlbGVtZW50OiBIVE1MRWxlbWVudCkge1xyXG4gICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3Qua2V5cyhzdHlsZXMpKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoZWxlbWVudCwgbmFtZSwgc3R5bGVzW25hbWUgYXMga2V5b2YgQ1NTU3R5bGVEZWNsYXJhdGlvbl0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZUJhY2tkcm9wU3R5bGVzKHJlY3RhbmdsZTogUmVjdGFuZ2xlKSB7XHJcbiAgICAgICAgY29uc3QgY29uZmlnID0gdGhpcy5zdGVwLmJhY2tkcm9wQ29uZmlnLFxyXG4gICAgICAgICAgICBub3JtYWxpemVkUmVjdCA9IHtcclxuICAgICAgICAgICAgICAgIC4uLnJlY3RhbmdsZSxcclxuICAgICAgICAgICAgICAgIHdpZHRoOiBNYXRoLm1heChyZWN0YW5nbGUud2lkdGgsIDApLFxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLm1heChyZWN0YW5nbGUuaGVpZ2h0LCAwKVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcclxuICAgICAgICAgICAgd2lkdGg6IGAke25vcm1hbGl6ZWRSZWN0LndpZHRofXB4YCxcclxuICAgICAgICAgICAgaGVpZ2h0OiBgJHtub3JtYWxpemVkUmVjdC5oZWlnaHR9cHhgLFxyXG4gICAgICAgICAgICB0b3A6IGAke25vcm1hbGl6ZWRSZWN0LnRvcH1weGAsXHJcbiAgICAgICAgICAgIGxlZnQ6IGAke25vcm1hbGl6ZWRSZWN0LmxlZnR9cHhgLFxyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGNvbmZpZz8uYmFja2dyb3VuZENvbG9yID8/ICdyZ2JhKDAsIDAsIDAsIDAuNyknLFxyXG4gICAgICAgICAgICB6SW5kZXg6IGNvbmZpZz8uekluZGV4ID8/ICcxMDEnXHJcbiAgICAgICAgfSBhcyBQYXJ0aWFsPENTU1N0eWxlRGVjbGFyYXRpb24+O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlQmFja2Ryb3BFbGVtZW50KCkge1xyXG4gICAgICAgIGNvbnN0IGJhY2tkcm9wRWxlbWVudCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhiYWNrZHJvcEVsZW1lbnQsICduZ3gtdWktdG91cl9iYWNrZHJvcCcpO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5wYXJlbnRDb250YWluZXIsIGJhY2tkcm9wRWxlbWVudCk7XHJcbiAgICAgICAgcmV0dXJuIGJhY2tkcm9wRWxlbWVudDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZUJhY2tkcm9wRWxlbWVudHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIEFycmF5XHJcbiAgICAgICAgICAgIC5mcm9tKHtsZW5ndGg6IDR9KVxyXG4gICAgICAgICAgICAubWFwKCgpID0+IHRoaXMuY3JlYXRlQmFja2Ryb3BFbGVtZW50KCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0IHBhcmVudENvbnRhaW5lcigpOiBIVE1MRWxlbWVudCB7XHJcbiAgICAgICAgY29uc3QgcGFyZW50ID0gdGhpcy5zdGVwLmJhY2tkcm9wQ29uZmlnPy5wYXJlbnRDb250YWluZXI7XHJcblxyXG4gICAgICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcGFyZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIHBhcmVudCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgY29uc3QgcXVlcnlSZXN1bHQgPSB0aGlzLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5xdWVyeVNlbGVjdG9yKHBhcmVudCkgYXMgSFRNTEVsZW1lbnQ7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVlcnlSZXN1bHQgPz8gdGhpcy5kb2N1bWVudC5ib2R5O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnQuYm9keTtcclxuICAgIH1cclxuXHJcbn1cclxuIl19